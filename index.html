<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0a0a0f">
    <title>VIRTUS CLOUD | Controle Financeiro na Nuvem</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-dark: #0a0a0f;
            --bg-medium: #13131a;
            --sidebar-bg: #0f0f14;
            --card-bg: #1a1a24;
            --card-hover: #1f1f2e;
            --text-main: #f5f5f7;
            --text-dim: #9999a8;
            --text-muted: #5d5d6b;
            --accent-primary: #00d4ff;
            --accent-secondary: #7c3aed;
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
            --accent-danger: #ef4444;
            --border-subtle: #2a2a38;
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.5);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.6);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Outfit', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-dark);
            color: var(--text-main);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* AUTH SCREEN */
        .auth-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #0a0a0f 0%, #1a0a2e 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 99999;
            padding: 20px;
        }

        .auth-screen.hidden {
            display: none;
        }

        .auth-container {
            background: var(--card-bg);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            padding: 40px;
            max-width: 450px;
            width: 100%;
            box-shadow: var(--shadow-lg);
        }

        .auth-logo {
            text-align: center;
            margin-bottom: 32px;
        }

        .auth-logo-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            margin-bottom: 16px;
            box-shadow: 0 8px 32px rgba(0, 212, 255, 0.4);
        }

        .auth-logo-text {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 2rem;
            letter-spacing: 3px;
            background: linear-gradient(135deg, var(--accent-primary), #fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .auth-subtitle {
            color: var(--text-dim);
            font-size: 0.95rem;
            margin-top: 8px;
        }

        .auth-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 32px;
            background: var(--bg-dark);
            padding: 4px;
            border-radius: 12px;
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            color: var(--text-dim);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            font-family: 'Outfit', sans-serif;
        }

        .auth-tab.active {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.85rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .form-input, .form-select {
            width: 100%;
            background: var(--bg-dark);
            border: 1px solid var(--border-subtle);
            color: var(--text-main);
            padding: 14px 16px;
            border-radius: 10px;
            font-size: 0.95rem;
            transition: all 0.2s;
            font-family: 'Outfit', sans-serif;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.95rem;
            font-family: 'Outfit', sans-serif;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            box-shadow: 0 4px 16px rgba(0, 212, 255, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 212, 255, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: var(--card-bg);
            border: 1px solid var(--border-subtle);
            color: var(--text-main);
        }

        .btn-success {
            background: var(--accent-success);
            color: white;
        }

        .btn-danger {
            background: var(--accent-danger);
            color: white;
        }

        .auth-error, .auth-success {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            display: none;
        }

        .auth-error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--accent-danger);
            color: var(--accent-danger);
        }

        .auth-success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--accent-success);
            color: var(--accent-success);
        }

        .auth-error.show, .auth-success.show {
            display: block;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* TOAST */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: var(--card-bg);
            border: 1px solid var(--border-subtle);
            border-left: 4px solid var(--accent-success);
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            min-width: 300px;
            max-width: 400px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease-out;
        }

        .toast.error { border-left-color: var(--accent-danger); }
        .toast.warning { border-left-color: var(--accent-warning); }
        .toast.info { border-left-color: var(--accent-primary); }

        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* SYNC STATUS */
        .sync-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--card-bg);
            border: 1px solid var(--border-subtle);
            padding: 12px 16px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.85rem;
            box-shadow: var(--shadow-md);
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .sync-status.show {
            opacity: 1;
        }

        .sync-icon {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-success);
        }

        .sync-icon.syncing {
            background: var(--accent-warning);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* APP LAYOUT */
        .app-wrapper {
            display: none;
        }

        .app-wrapper.show {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            z-index: 1000;
            overflow-y: auto;
        }

        .logo-area {
            padding: 28px 24px;
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 16px rgba(0, 212, 255, 0.3);
        }

        .logo-text {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 1.4rem;
            letter-spacing: 2px;
            background: linear-gradient(135deg, var(--accent-primary), #fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-menu {
            list-style: none;
            padding: 20px 12px;
            flex: 1;
        }

        .nav-item {
            padding: 12px 20px;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 14px;
            cursor: pointer;
            color: var(--text-dim);
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
            border-radius: 10px;
        }

        .nav-item:hover {
            background: rgba(0, 212, 255, 0.08);
            color: var(--text-main);
        }

        .nav-item.active {
            background: rgba(0, 212, 255, 0.12);
            color: var(--accent-primary);
            font-weight: 600;
        }

        .sidebar-footer {
            padding: 16px;
            border-top: 1px solid var(--border-subtle);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--card-bg);
            border-radius: 10px;
            margin-bottom: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .user-info {
            flex: 1;
            min-width: 0;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-email {
            font-size: 0.75rem;
            color: var(--text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .btn-logout {
            width: 100%;
            padding: 12px;
            background: var(--card-bg);
            border: 1px solid var(--border-subtle);
            color: var(--accent-danger);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            font-family: 'Outfit', sans-serif;
        }

        .btn-logout:hover {
            background: rgba(239, 68, 68, 0.1);
        }

        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 32px;
            min-height: 100vh;
        }

        .page-header {
            margin-bottom: 32px;
            display: flex;
            justify-content: space-between;
            align-items: start;
            flex-wrap: wrap;
            gap: 16px;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .page-subtitle {
            color: var(--text-dim);
            font-size: 0.9rem;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .kpi-card {
            background: var(--card-bg);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s;
        }

        .kpi-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .kpi-label {
            font-size: 0.85rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .section-box {
            background: var(--card-bg);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 24px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            text-align: left;
            padding: 14px 16px;
            font-size: 0.8rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
            border-bottom: 2px solid var(--border-subtle);
        }

        .data-table td {
            padding: 16px;
            border-bottom: 1px solid var(--border-subtle);
            font-size: 0.9rem;
        }

        .data-table tbody tr:hover {
            background: var(--bg-medium);
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.15);
            color: var(--accent-success);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.15);
            color: var(--accent-warning);
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.15);
            color: var(--accent-danger);
        }

        .badge-info {
            background: rgba(0, 212, 255, 0.15);
            color: var(--accent-primary);
        }

        .btn-icon {
            background: none;
            border: none;
            cursor: pointer;
            padding: 6px;
            border-radius: 6px;
            transition: all 0.2s;
            color: var(--text-dim);
        }

        .btn-icon:hover {
            background: var(--card-hover);
            color: var(--accent-danger);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* MODAL */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--card-bg);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            padding: 32px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-dim);
            cursor: pointer;
            font-size: 1.5rem;
            padding: 4px;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }

            .sidebar.mobile-visible {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 20px;
            }

            .kpi-grid {
                grid-template-columns: 1fr;
            }

            .page-title {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>

<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<!-- Sync Status -->
<div class="sync-status" id="syncStatus">
    <div class="sync-icon" id="syncIcon"></div>
    <span id="syncText">Sincronizado</span>
</div>

<!-- AUTH SCREEN -->
<div class="auth-screen" id="authScreen">
    <div class="auth-container">
        <div class="auth-logo">
            <div class="auth-logo-icon">
                <i class="fa-solid fa-shield-halved"></i>
            </div>
            <div class="auth-logo-text">VIRTUS</div>
            <div class="auth-subtitle">Controle Financeiro na Nuvem</div>
        </div>

        <div class="auth-tabs">
            <button class="auth-tab active" onclick="switchAuthTab('login')">Entrar</button>
            <button class="auth-tab" onclick="switchAuthTab('register')">Cadastrar</button>
        </div>

        <div id="authError" class="auth-error"></div>
        <div id="authSuccess" class="auth-success"></div>

        <!-- LOGIN FORM -->
        <form class="auth-form active" id="loginForm" onsubmit="handleLogin(event)">
            <div class="form-group">
                <label class="form-label">E-mail</label>
                <input type="email" class="form-input" id="loginEmail" required placeholder="seu@email.com">
            </div>
            <div class="form-group">
                <label class="form-label">Senha</label>
                <input type="password" class="form-input" id="loginPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <button type="submit" class="btn btn-primary" id="loginBtn">
                Entrar
            </button>
        </form>

        <!-- REGISTER FORM -->
        <form class="auth-form" id="registerForm" onsubmit="handleRegister(event)">
            <div class="form-group">
                <label class="form-label">Nome Completo</label>
                <input type="text" class="form-input" id="registerName" required placeholder="Seu nome">
            </div>
            <div class="form-group">
                <label class="form-label">E-mail</label>
                <input type="email" class="form-input" id="registerEmail" required placeholder="seu@email.com">
            </div>
            <div class="form-group">
                <label class="form-label">Senha</label>
                <input type="password" class="form-input" id="registerPassword" required placeholder="M√≠nimo 6 caracteres">
            </div>
            <div class="form-group">
                <label class="form-label">Confirmar Senha</label>
                <input type="password" class="form-input" id="registerPasswordConfirm" required placeholder="Digite a senha novamente">
            </div>
            <button type="submit" class="btn btn-primary" id="registerBtn">
                Criar Conta
            </button>
        </form>
    </div>
</div>

<!-- APP -->
<div class="app-wrapper" id="appWrapper">
    <aside class="sidebar" id="sidebar">
        <div class="logo-area">
            <div class="logo-icon">
                <i class="fa-solid fa-shield-halved"></i>
            </div>
            <div>
                <div class="logo-text">VIRTUS</div>
            </div>
        </div>

        <ul class="nav-menu">
            <li class="nav-item active" onclick="switchTab('dashboard')">
                <i class="fa-solid fa-chart-pie"></i>
                <span>Dashboard</span>
            </li>
            <li class="nav-item" onclick="switchTab('transacoes')">
                <i class="fa-solid fa-exchange-alt"></i>
                <span>Transa√ß√µes</span>
            </li>
            <li class="nav-item" onclick="switchTab('investimentos')">
                <i class="fa-solid fa-chart-line"></i>
                <span>Investimentos</span>
            </li>
            <li class="nav-item" onclick="switchTab('metas')">
                <i class="fa-solid fa-bullseye"></i>
                <span>Metas</span>
            </li>
        </ul>

        <div class="sidebar-footer">
            <div class="user-profile">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-info">
                    <div class="user-name" id="userName">Usu√°rio</div>
                    <div class="user-email" id="userEmail">email@exemplo.com</div>
                </div>
            </div>
            <button class="btn-logout" onclick="handleLogout()">
                <i class="fa-solid fa-right-from-bracket"></i> Sair
            </button>
        </div>
    </aside>

    <main class="main-content">
        <!-- DASHBOARD -->
        <div id="dashboard" class="tab-content active">
            <div class="page-header">
                <div>
                    <h1 class="page-title">
                        <i class="fa-solid fa-chart-pie"></i>
                        Dashboard
                    </h1>
                    <p class="page-subtitle">Vis√£o geral das suas finan√ßas</p>
                </div>
                <button class="btn btn-primary" onclick="openModal('addTransModal')">
                    <i class="fa-solid fa-plus"></i>
                    Nova Transa√ß√£o
                </button>
            </div>

            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-label">Saldo Total</div>
                    <div class="kpi-value" style="color: var(--accent-primary);" id="totalBalance">R$ 0,00</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Receitas</div>
                    <div class="kpi-value" style="color: var(--accent-success);" id="totalIncome">R$ 0,00</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Despesas</div>
                    <div class="kpi-value" style="color: var(--accent-danger);" id="totalExpenses">R$ 0,00</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Investimentos</div>
                    <div class="kpi-value" style="color: var(--accent-secondary);" id="totalInvestments">R$ 0,00</div>
                </div>
            </div>

            <div class="section-box">
                <h3 style="margin-bottom: 16px; color: var(--accent-primary);">
                    <i class="fa-solid fa-cloud"></i> Sistema com Sincroniza√ß√£o na Nuvem
                </h3>
                <p style="color: var(--text-dim); line-height: 1.8;">
                    ‚úÖ Seus dados est√£o sendo salvos automaticamente no Firebase<br>
                    ‚úÖ Acesse de qualquer dispositivo com o mesmo login<br>
                    ‚úÖ Sincroniza√ß√£o em tempo real<br>
                    ‚úÖ Backup autom√°tico na nuvem<br>
                    ‚úÖ Seguro e criptografado
                </p>
            </div>
        </div>

        <!-- TRANSA√á√ïES -->
        <div id="transacoes" class="tab-content">
            <div class="page-header">
                <div>
                    <h1 class="page-title">
                        <i class="fa-solid fa-exchange-alt"></i>
                        Transa√ß√µes
                    </h1>
                    <p class="page-subtitle">Gerencie suas receitas e despesas</p>
                </div>
                <button class="btn btn-primary" onclick="openModal('addTransModal')">
                    <i class="fa-solid fa-plus"></i>
                    Nova Transa√ß√£o
                </button>
            </div>

            <div class="section-box">
                <div class="section-header">
                    <h2 class="section-title">√öltimas Transa√ß√µes</h2>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Descri√ß√£o</th>
                            <th>Tipo</th>
                            <th>Valor</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="transTable">
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 40px; color: var(--text-muted);">
                                Nenhuma transa√ß√£o cadastrada
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- INVESTIMENTOS -->
        <div id="investimentos" class="tab-content">
            <div class="page-header">
                <div>
                    <h1 class="page-title">
                        <i class="fa-solid fa-chart-line"></i>
                        Investimentos
                    </h1>
                    <p class="page-subtitle">Acompanhe sua carteira</p>
                </div>
                <button class="btn btn-primary" onclick="openModal('addInvestModal')">
                    <i class="fa-solid fa-plus"></i>
                    Novo Investimento
                </button>
            </div>

            <div class="section-box">
                <div class="section-header">
                    <h2 class="section-title">Carteira de Investimentos</h2>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Ativo</th>
                            <th>Tipo</th>
                            <th>Valor Investido</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="investTable">
                        <tr>
                            <td colspan="4" style="text-align: center; padding: 40px; color: var(--text-muted);">
                                Nenhum investimento cadastrado
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- METAS -->
        <div id="metas" class="tab-content">
            <div class="page-header">
                <div>
                    <h1 class="page-title">
                        <i class="fa-solid fa-bullseye"></i>
                        Metas Financeiras
                    </h1>
                    <p class="page-subtitle">Defina e acompanhe seus objetivos</p>
                </div>
                <button class="btn btn-primary" onclick="openModal('addMetaModal')">
                    <i class="fa-solid fa-plus"></i>
                    Nova Meta
                </button>
            </div>

            <div id="metasContainer">
                <div style="text-align: center; padding: 60px 20px; color: var(--text-muted);">
                    <i class="fa-solid fa-bullseye" style="font-size: 3rem; margin-bottom: 16px; opacity: 0.5;"></i>
                    <h3 style="margin-bottom: 8px;">Nenhuma meta definida</h3>
                    <p>Crie metas para alcan√ßar seus objetivos financeiros</p>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- MODALS -->
<!-- Add Transaction Modal -->
<div class="modal-overlay" id="addTransModal">
    <div class="modal">
        <div class="modal-header">
            <h2 class="modal-title">Nova Transa√ß√£o</h2>
            <button class="modal-close" onclick="closeModal('addTransModal')">
                <i class="fa-solid fa-times"></i>
            </button>
        </div>
        <form onsubmit="addTransaction(event)">
            <div class="form-group">
                <label class="form-label">Descri√ß√£o</label>
                <input type="text" class="form-input" id="transDesc" required>
            </div>
            <div class="form-group">
                <label class="form-label">Valor</label>
                <input type="number" class="form-input" id="transValor" step="0.01" required>
            </div>
            <div class="form-group">
                <label class="form-label">Data</label>
                <input type="date" class="form-input" id="transData" required>
            </div>
            <div class="form-group">
                <label class="form-label">Tipo</label>
                <select class="form-select" id="transTipo" required>
                    <option value="Receita">üí∞ Receita</option>
                    <option value="Despesa">üí∏ Despesa</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">
                <i class="fa-solid fa-check"></i>
                Adicionar
            </button>
        </form>
    </div>
</div>

<!-- Add Investment Modal -->
<div class="modal-overlay" id="addInvestModal">
    <div class="modal">
        <div class="modal-header">
            <h2 class="modal-title">Novo Investimento</h2>
            <button class="modal-close" onclick="closeModal('addInvestModal')">
                <i class="fa-solid fa-times"></i>
            </button>
        </div>
        <form onsubmit="addInvestment(event)">
            <div class="form-group">
                <label class="form-label">Nome do Ativo</label>
                <input type="text" class="form-input" id="investNome" required>
            </div>
            <div class="form-group">
                <label class="form-label">Valor Investido</label>
                <input type="number" class="form-input" id="investValor" step="0.01" required>
            </div>
            <div class="form-group">
                <label class="form-label">Tipo</label>
                <select class="form-select" id="investTipo" required>
                    <option value="Renda Fixa">üè¶ Renda Fixa</option>
                    <option value="A√ß√µes">üìä A√ß√µes</option>
                    <option value="Cripto">‚Çø Cripto</option>
                    <option value="FIIs">üè¢ FIIs</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">
                <i class="fa-solid fa-check"></i>
                Adicionar
            </button>
        </form>
    </div>
</div>

<!-- Add Meta Modal -->
<div class="modal-overlay" id="addMetaModal">
    <div class="modal">
        <div class="modal-header">
            <h2 class="modal-title">Nova Meta</h2>
            <button class="modal-close" onclick="closeModal('addMetaModal')">
                <i class="fa-solid fa-times"></i>
            </button>
        </div>
        <form onsubmit="addMeta(event)">
            <div class="form-group">
                <label class="form-label">Nome da Meta</label>
                <input type="text" class="form-input" id="metaNome" required>
            </div>
            <div class="form-group">
                <label class="form-label">Valor Alvo</label>
                <input type="number" class="form-input" id="metaValor" step="0.01" required>
            </div>
            <div class="form-group">
                <label class="form-label">Valor Atual</label>
                <input type="number" class="form-input" id="metaAtual" step="0.01" value="0">
            </div>
            <div class="form-group">
                <label class="form-label">Data Limite</label>
                <input type="date" class="form-input" id="metaData" required>
            </div>
            <button type="submit" class="btn btn-primary">
                <i class="fa-solid fa-check"></i>
                Criar Meta
            </button>
        </form>
    </div>
</div>

<script>
// ============================================
// FIREBASE CONFIGURATION
// ============================================
const firebaseConfig = {
    apiKey: "AIzaSyDQUKmnzlY95tYAnIfn2Zvl0kNDSz_YeLA",
    authDomain: "virtus-financeiro-9ead3.firebaseapp.com",
    projectId: "virtus-financeiro-9ead3",
    storageBucket: "virtus-financeiro-9ead3.firebasestorage.app",
    messagingSenderId: "16821317087",
    appId: "1:16821317087:web:09a5a31e7bb3a57a6ce86a"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Global State
let currentUser = null;
let userData = {
    trans: [],
    invest: [],
    metas: []
};

// ============================================
// AUTHENTICATION
// ============================================
function switchAuthTab(tab) {
    document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
    
    if (tab === 'login') {
        document.querySelectorAll('.auth-tab')[0].classList.add('active');
        document.getElementById('loginForm').classList.add('active');
    } else {
        document.querySelectorAll('.auth-tab')[1].classList.add('active');
        document.getElementById('registerForm').classList.add('active');
    }
    
    hideAuthMessages();
}

async function handleLogin(e) {
    e.preventDefault();
    
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    const btn = document.getElementById('loginBtn');
    
    btn.disabled = true;
    btn.innerHTML = '<span class="loading-spinner"></span> Entrando...';
    hideAuthMessages();
    
    try {
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        currentUser = userCredential.user;
        showToast('Login realizado com sucesso!', 'success');
        await loadUserData();
        showApp();
    } catch (error) {
        showAuthError(getErrorMessage(error.code));
        btn.disabled = false;
        btn.innerHTML = 'Entrar';
    }
}

async function handleRegister(e) {
    e.preventDefault();
    
    const name = document.getElementById('registerName').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;
    const confirmPassword = document.getElementById('registerPasswordConfirm').value;
    const btn = document.getElementById('registerBtn');
    
    if (password !== confirmPassword) {
        showAuthError('As senhas n√£o coincidem');
        return;
    }
    
    if (password.length < 6) {
        showAuthError('A senha deve ter no m√≠nimo 6 caracteres');
        return;
    }
    
    btn.disabled = true;
    btn.innerHTML = '<span class="loading-spinner"></span> Criando conta...';
    hideAuthMessages();
    
    try {
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        currentUser = userCredential.user;
        
        await currentUser.updateProfile({ displayName: name });
        
        await db.collection('users').doc(currentUser.uid).set({
            name: name,
            email: email,
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            trans: [],
            invest: [],
            metas: []
        });
        
        showAuthSuccess('Conta criada com sucesso! Redirecionando...');
        
        setTimeout(() => {
            loadUserData();
            showApp();
        }, 1500);
        
    } catch (error) {
        showAuthError(getErrorMessage(error.code));
        btn.disabled = false;
        btn.innerHTML = 'Criar Conta';
    }
}

async function handleLogout() {
    if (confirm('Deseja realmente sair?')) {
        try {
            await auth.signOut();
            currentUser = null;
            userData = { trans: [], invest: [], metas: [] };
            hideApp();
            showToast('Logout realizado com sucesso', 'info');
        } catch (error) {
            showToast('Erro ao fazer logout', 'error');
        }
    }
}

// ============================================
// FIREBASE DATA SYNC
// ============================================
async function loadUserData() {
    if (!currentUser) return;
    
    showSyncStatus('syncing', 'Sincronizando...');
    
    try {
        const doc = await db.collection('users').doc(currentUser.uid).get();
        
        if (doc.exists) {
            const data = doc.data();
            userData = {
                trans: data.trans || [],
                invest: data.invest || [],
                metas: data.metas || []
            };
        }
        
        updateDashboard();
        renderTransactions();
        renderInvestments();
        renderMetas();
        
        showSyncStatus('synced', 'Sincronizado');
        setTimeout(() => hideSyncStatus(), 2000);
        
    } catch (error) {
        console.error('Erro ao carregar dados:', error);
        showToast('Erro ao carregar dados', 'error');
    }
}

async function saveUserData() {
    if (!currentUser) return;
    
    showSyncStatus('syncing', 'Salvando...');
    
    try {
        await db.collection('users').doc(currentUser.uid).update({
            trans: userData.trans,
            invest: userData.invest,
            metas: userData.metas,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        updateDashboard();
        renderTransactions();
        renderInvestments();
        renderMetas();
        
        showSyncStatus('synced', 'Salvo');
        setTimeout(() => hideSyncStatus(), 2000);
        
    } catch (error) {
        console.error('Erro ao salvar dados:', error);
        showToast('Erro ao sincronizar dados', 'error');
    }
}

// ============================================
// DATA MANAGEMENT
// ============================================
async function addTransaction(e) {
    e.preventDefault();
    
    const desc = document.getElementById('transDesc').value;
    const valor = parseFloat(document.getElementById('transValor').value);
    const data = document.getElementById('transData').value;
    const tipo = document.getElementById('transTipo').value;
    
    userData.trans.push({
        desc,
        valor,
        data,
        tipo,
        createdAt: new Date().toISOString()
    });
    
    await saveUserData();
    closeModal('addTransModal');
    e.target.reset();
    showToast('Transa√ß√£o adicionada!', 'success');
}

async function deleteTransaction(index) {
    if (confirm('Deseja remover esta transa√ß√£o?')) {
        userData.trans.splice(index, 1);
        await saveUserData();
        showToast('Transa√ß√£o removida', 'info');
    }
}

async function addInvestment(e) {
    e.preventDefault();
    
    const nome = document.getElementById('investNome').value;
    const valor = parseFloat(document.getElementById('investValor').value);
    const tipo = document.getElementById('investTipo').value;
    
    userData.invest.push({
        nome,
        valor,
        tipo,
        createdAt: new Date().toISOString()
    });
    
    await saveUserData();
    closeModal('addInvestModal');
    e.target.reset();
    showToast('Investimento adicionado!', 'success');
}

async function deleteInvestment(index) {
    if (confirm('Deseja remover este investimento?')) {
        userData.invest.splice(index, 1);
        await saveUserData();
        showToast('Investimento removido', 'info');
    }
}

async function addMeta(e) {
    e.preventDefault();
    
    const nome = document.getElementById('metaNome').value;
    const valor = parseFloat(document.getElementById('metaValor').value);
    const atual = parseFloat(document.getElementById('metaAtual').value);
    const data = document.getElementById('metaData').value;
    
    userData.metas.push({
        nome,
        valor,
        atual,
        data,
        createdAt: new Date().toISOString()
    });
    
    await saveUserData();
    closeModal('addMetaModal');
    e.target.reset();
    showToast('Meta criada!', 'success');
}

async function deleteMeta(index) {
    if (confirm('Deseja remover esta meta?')) {
        userData.metas.splice(index, 1);
        await saveUserData();
        showToast('Meta removida', 'info');
    }
}

// ============================================
// UI UPDATES
// ============================================
function updateDashboard() {
    const totalIncome = userData.trans
        .filter(t => t.tipo === 'Receita')
        .reduce((sum, t) => sum + parseFloat(t.valor), 0);
    
    const totalExpenses = userData.trans
        .filter(t => t.tipo === 'Despesa')
        .reduce((sum, t) => sum + parseFloat(t.valor), 0);
    
    const totalInvestments = userData.invest
        .reduce((sum, i) => sum + parseFloat(i.valor), 0);
    
    const balance = totalIncome - totalExpenses;
    
    document.getElementById('totalBalance').textContent = formatCurrency(balance);
    document.getElementById('totalIncome').textContent = formatCurrency(totalIncome);
    document.getElementById('totalExpenses').textContent = formatCurrency(totalExpenses);
    document.getElementById('totalInvestments').textContent = formatCurrency(totalInvestments);
}

function renderTransactions() {
    const tbody = document.getElementById('transTable');
    
    if (userData.trans.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 40px; color: var(--text-muted);">Nenhuma transa√ß√£o cadastrada</td></tr>';
        return;
    }
    
    tbody.innerHTML = userData.trans
        .sort((a, b) => new Date(b.data) - new Date(a.data))
        .map((t, i) => `
            <tr>
                <td>${new Date(t.data).toLocaleDateString('pt-BR')}</td>
                <td><strong>${t.desc}</strong></td>
                <td><span class="badge ${t.tipo === 'Receita' ? 'badge-success' : 'badge-danger'}">${t.tipo}</span></td>
                <td style="color: ${t.tipo === 'Receita' ? 'var(--accent-success)' : 'var(--accent-danger)'}; font-weight: 600;">${formatCurrency(t.valor)}</td>
                <td>
                    <button class="btn-icon" onclick="deleteTransaction(${i})">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                </td>
            </tr>
        `).join('');
}

function renderInvestments() {
    const tbody = document.getElementById('investTable');
    
    if (userData.invest.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 40px; color: var(--text-muted);">Nenhum investimento cadastrado</td></tr>';
        return;
    }
    
    tbody.innerHTML = userData.invest.map((inv, i) => `
        <tr>
            <td><strong>${inv.nome}</strong></td>
            <td><span class="badge badge-info">${inv.tipo}</span></td>
            <td style="color: var(--accent-success); font-weight: 600;">${formatCurrency(inv.valor)}</td>
            <td>
                <button class="btn-icon" onclick="deleteInvestment(${i})">
                    <i class="fa-solid fa-trash"></i>
                </button>
            </td>
        </tr>
    `).join('');
}

function renderMetas() {
    const container = document.getElementById('metasContainer');
    
    if (userData.metas.length === 0) {
        container.innerHTML = `
            <div style="text-align: center; padding: 60px 20px; color: var(--text-muted);">
                <i class="fa-solid fa-bullseye" style="font-size: 3rem; margin-bottom: 16px; opacity: 0.5;"></i>
                <h3 style="margin-bottom: 8px;">Nenhuma meta definida</h3>
                <p>Crie metas para alcan√ßar seus objetivos financeiros</p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = userData.metas.map((meta, i) => {
        const progresso = (meta.atual / meta.valor * 100).toFixed(0);
        const diasRestantes = Math.ceil((new Date(meta.data) - new Date()) / (1000 * 60 * 60 * 24));
        
        return `
            <div class="section-box">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
                    <div>
                        <h3 style="font-size: 1.2rem; margin-bottom: 8px;">${meta.nome}</h3>
                        <p style="color: var(--text-dim);">${formatCurrency(meta.atual)} de ${formatCurrency(meta.valor)}</p>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <span class="badge ${diasRestantes > 30 ? 'badge-success' : diasRestantes > 7 ? 'badge-warning' : 'badge-danger'}">
                            ${diasRestantes > 0 ? diasRestantes + ' dias' : 'Expirada'}
                        </span>
                        <button class="btn-icon" onclick="deleteMeta(${i})">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>
                </div>
                <div style="width: 100%; height: 8px; background: var(--bg-dark); border-radius: 10px; overflow: hidden;">
                    <div style="height: 100%; width: ${progresso}%; background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary)); border-radius: 10px; transition: width 0.3s;"></div>
                </div>
                <div style="margin-top: 8px; text-align: right; color: var(--text-dim); font-size: 0.9rem;">
                    ${progresso}% conclu√≠do
                </div>
            </div>
        `;
    }).join('');
}

// ============================================
// UI HELPERS
// ============================================
function showApp() {
    document.getElementById('authScreen').classList.add('hidden');
    document.getElementById('appWrapper').classList.add('show');
    
    if (currentUser) {
        const name = currentUser.displayName || 'Usu√°rio';
        const email = currentUser.email;
        
        document.getElementById('userName').textContent = name;
        document.getElementById('userEmail').textContent = email;
        document.getElementById('userAvatar').textContent = name.charAt(0).toUpperCase();
    }
}

function hideApp() {
    document.getElementById('authScreen').classList.remove('hidden');
    document.getElementById('appWrapper').classList.remove('show');
}

function showAuthError(message) {
    const errorEl = document.getElementById('authError');
    errorEl.textContent = message;
    errorEl.classList.add('show');
}

function showAuthSuccess(message) {
    const successEl = document.getElementById('authSuccess');
    successEl.textContent = message;
    successEl.classList.add('show');
}

function hideAuthMessages() {
    document.getElementById('authError').classList.remove('show');
    document.getElementById('authSuccess').classList.remove('show');
}

function showToast(message, type = 'success') {
    const container = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    
    const icons = {
        success: 'fa-check-circle',
        error: 'fa-exclamation-circle',
        warning: 'fa-exclamation-triangle',
        info: 'fa-info-circle'
    };
    
    toast.innerHTML = `
        <i class="fa-solid ${icons[type]}"></i>
        <span>${message}</span>
    `;
    
    container.appendChild(toast);
    
    setTimeout(() => {
        toast.style.animation = 'slideIn 0.3s ease-out reverse';
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

function showSyncStatus(status, text) {
    const statusEl = document.getElementById('syncStatus');
    const iconEl = document.getElementById('syncIcon');
    const textEl = document.getElementById('syncText');
    
    iconEl.className = 'sync-icon';
    if (status === 'syncing') {
        iconEl.classList.add('syncing');
    }
    
    textEl.textContent = text;
    statusEl.classList.add('show');
}

function hideSyncStatus() {
    document.getElementById('syncStatus').classList.remove('show');
}

function formatCurrency(value) {
    return new Intl.NumberFormat('pt-BR', {
        style: 'currency',
        currency: 'BRL'
    }).format(value);
}

function getErrorMessage(code) {
    const messages = {
        'auth/email-already-in-use': 'Este e-mail j√° est√° em uso',
        'auth/invalid-email': 'E-mail inv√°lido',
        'auth/weak-password': 'Senha muito fraca',
        'auth/user-not-found': 'Usu√°rio n√£o encontrado',
        'auth/wrong-password': 'Senha incorreta',
        'auth/too-many-requests': 'Muitas tentativas. Aguarde um momento',
        'auth/network-request-failed': 'Erro de conex√£o'
    };
    
    return messages[code] || 'Erro ao processar solicita√ß√£o';
}

function switchTab(tabId) {
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    
    document.getElementById(tabId).classList.add('active');
    event.currentTarget.classList.add('active');
}

function openModal(modalId) {
    document.getElementById(modalId).classList.add('active');
}

function closeModal(modalId) {
    document.getElementById(modalId).classList.remove('active');
}

// ============================================
// AUTH STATE OBSERVER
// ============================================
auth.onAuthStateChanged(async (user) => {
    if (user) {
        currentUser = user;
        await loadUserData();
        showApp();
    } else {
        currentUser = null;
        hideApp();
    }
});

// ============================================
// INITIALIZATION
// ============================================
window.addEventListener('load', () => {
    console.log('VIRTUS Cloud inicializado com Firebase');
    document.getElementById('transData').valueAsDate = new Date();
    
    // Close modals when clicking outside
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
        overlay.addEventListener('click', (e) => {
            if (e.target === overlay) {
                overlay.classList.remove('active');
            }
        });
    });
});
</script>

</body>
</html>
